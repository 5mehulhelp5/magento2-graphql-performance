<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <!-- Plugin for GraphQL query processing -->
    <type name="Magento\Framework\GraphQl\Query\QueryProcessor">
        <!-- Security plugin runs first to validate requests -->
        <plugin name="sterk_graphql_performance_security"
                type="Sterk\GraphQlPerformance\Plugin\GraphQl\SecurityPlugin"
                sortOrder="10"/>

        <!-- Query cache plugin runs second to check cache -->
        <plugin name="sterk_graphql_performance_query_cache"
                type="Sterk\GraphQlPerformance\Plugin\GraphQl\QueryCachePlugin"
                sortOrder="20"/>

        <!-- Connection manager plugin runs last to handle DB connections -->
        <plugin name="sterk_graphql_performance_connection_manager"
                type="Sterk\GraphQlPerformance\Plugin\GraphQl\ConnectionManagerPlugin"
                sortOrder="30"/>
    </type>

    <!-- Cache Warmer configuration -->
    <type name="Sterk\GraphQlPerformance\Model\Cache\CacheWarmer">
        <arguments>
            <argument name="queryProcessor" xsi:type="object">Magento\Framework\GraphQl\Query\QueryProcessor\Proxy</argument>
            <argument name="storeManager" xsi:type="object">Magento\Store\Model\StoreManagerInterface\Proxy</argument>
            <argument name="scopeConfig" xsi:type="object">Magento\Framework\App\Config\ScopeConfigInterface\Proxy</argument>
            <argument name="logger" xsi:type="object">Psr\Log\LoggerInterface</argument>
            <argument name="schemaGenerator" xsi:type="object">Magento\Framework\GraphQl\Schema\SchemaGeneratorInterface</argument>
        </arguments>
    </type>
</config>
