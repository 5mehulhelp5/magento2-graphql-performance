<?php
/** @var \Sterk\GraphQlPerformance\Block\Adminhtml\Metrics\Chart $block */
$metrics = $block->getMetrics();
?>
<div class="graphql-performance-metrics-chart">
    <div class="admin__field-complex-title">
        <span><?= $block->escapeHtml(__('Performance Overview')) ?></span>
    </div>
    <div class="admin__field-complex-content">
        <div class="metrics-chart-container">
            <canvas id="metricsChart" width="800" height="400"></canvas>
        </div>
        <div class="metrics-summary">
            <div class="metric-box">
                <span class="metric-label"><?= $block->escapeHtml(__('Average Response Time')) ?></span>
                <span class="metric-value"><?= $block->getFormattedMetricValue($metrics, 'average_response_time') ?> ms</span>
            </div>
            <div class="metric-box">
                <span class="metric-label"><?= $block->escapeHtml(__('Cache Hit Rate')) ?></span>
                <span class="metric-value"><?= $block->getFormattedMetricValue($metrics, 'cache_hit_rate', '%.1f', 0) ?>%</span>
            </div>
            <div class="metric-box">
                <span class="metric-label"><?= $block->escapeHtml(__('Error Rate')) ?></span>
                <span class="metric-value"><?= $block->getFormattedMetricValue($metrics, 'error_rate', '%.1f', 0) ?>%</span>
            </div>
            <div class="metric-box">
                <span class="metric-label"><?= $block->escapeHtml(__('Memory Usage')) ?></span>
                <span class="metric-value"><?= $block->getFormattedMetricValue($metrics, 'memory_usage/current_usage', '%.1f', 0) ?> MB</span>
            </div>
        </div>
    </div>
</div>

<script>
require([
    'Sterk_GraphQlPerformance/js/metrics-chart'
], function (initChart) {
    'use strict';

    initChart({
        data: <?= /* @noEscape */ json_encode($block->getChartData()) ?>,
        labels: {
            responseTime: '<?= $block->escapeJs(__('Response Time (ms)')) ?>',
            cacheHitRate: '<?= $block->escapeJs(__('Cache Hit Rate (%)')) ?>'
        }
    });
});
